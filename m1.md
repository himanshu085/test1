<p align="center"> 
  <img src="https://raw.githubusercontent.com/github/explore/main/topics/database/database.png" alt="Migration Logo" width="120"/> 
</p>

# 🔄 Migration Tool Setup & Usage SOP (Multi-Language Support)

| Author   | Created on | Version | Last updated by | Last edited on | Internal Reviewer | Reviewer L0 | Reviewer L1 | Reviewer L2 |
|----------|-------------|---------|------------------|------------------|-------------------|-------------|-------------|-------------|
| Himanshu | 2025-04-16  | 1.0     | Himanshu         | 2025-04-16       | Komal Jaiswal     | Imran       | Shashi      | Mahesh Kumar |

## 📚 Table of Contents

- 📌 Overview  
- ❓ What is a Database Migration Tool?  
- 💡 Why Use Migrate CLI?  
- 🔧 Installation Steps  
- 🗂️ Directory Structure  
- ⚙️ Create a New Migration  
- 🚀 Run Migrations  
- 📋 Rollback Migrations  
- 🧼 Cleanup  
- ✅ Best Practices  
- 🧾 Conclusion  
- 📞 Contact Information  
- 📎 References  

## 📌 Overview
This SOP provides a universal guide to installing and using the migrate CLI tool for database schema changes in projects built with Go, Python, or other backend technologies. It is applicable across multiple repositories such as employee-api, salary-api, and attendance-api.

## ❓ What is a Database Migration Tool?
A database migration tool allows you to version control your database schema. Instead of applying changes manually, you define them in files, which migrate runs for you.

## 💡 Why Use Migrate CLI?
- Supports multiple databases (PostgreSQL, MySQL, SQLite)  
- Easy to integrate into CI/CD  
- Reversible migrations (up/down)  
- Language-agnostic  

## 🔧 Installation Steps
```bash
# Go to home directory
cd ~

# Download migrate CLI binary
wget https://github.com/golang-migrate/migrate/releases/download/v4.15.2/migrate.linux-amd64.tar.gz

# Extract the binary
tar -xvf migrate.linux-amd64.tar.gz

# Move to a binary-accessible directory
sudo mv migrate /usr/local/bin/migrate

# Give execute permission
sudo chmod +x /usr/local/bin/migrate

# Verify installation
migrate -version
```

## 🗂️ Directory Structure

Ensure each repo has a migration folder with files like:

```
project-root/
│
├── migration/
│   ├── 001_init.up.sql
│   ├── 001_init.down.sql
│   └── ...
```

## ⚙️ Create a New Migration

Use this command inside your project directory (replace name accordingly):

```bash
migrate create -ext sql -dir migration -seq create_users_table
```

This will generate:

```
migration/
├── 002_create_users_table.up.sql
├── 002_create_users_table.down.sql
```

## 🚀 Run Migrations

Make sure the database URL is correct.

**PostgreSQL Example:**

```bash
migrate -path migration -database "postgres://user:password@localhost:5432/dbname?sslmode=disable" up
```

**MySQL Example:**

```bash
migrate -path migration -database "mysql://user:password@tcp(localhost:3306)/dbname" up
```

**SQLite Example:**

```bash
migrate -path migration -database "sqlite3://db.sqlite" up
```

## 📋 Rollback Migrations

```bash
# Rollback last migration step
migrate -path migration -database <DB_URL> down 1
```

## 🧼 Cleanup

```bash
# Drop all migrations
migrate -path migration -database <DB_URL> drop
```

## ✅ Best Practices

- 🔒 Keep sensitive DB URLs in environment variables  
- 🧪 Test on staging before production  
- 🧾 Add descriptive names to migration files  
- ✅ Validate migrations before pushing  
- 🧹 Clean up unused files  

## 🧾 Conclusion

This SOP helps standardize and streamline the process of database migrations across various projects and tech stacks. Following this guide ensures version-controlled, reversible, and consistent schema management for production-grade backend services.

## 📞 Contact Information

| Name             | Email Address                                |
|------------------|----------------------------------------------|
| Himanshu Parashar| himanshu.parashar.snaatak@mygurukulam.co     |

## 📎 References

- [Migrate CLI - Official Docs](https://github.com/golang-migrate/migrate)  
- [PostgreSQL URL Format](https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING)  
- [MySQL URL Format](https://github.com/go-sql-driver/mysql#dsn-data-source-name)
